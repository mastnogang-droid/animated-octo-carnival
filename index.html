<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stateout ‚Äî ‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { margin:0; font-family:sans-serif; background:#f0f8ff; }
    header { background:#0078d7; color:white; padding:12px 18px; text-align:center; }
    h1 { margin:0; font-size:20px; }
    #map { height:70vh; }
    .panel { text-align:center; padding:12px; }
    button { background:#0078d7; color:white; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; }
    button:hover { background:#005fa3; }
    #status { margin:10px 0; color:#333; }
  </style>
</head>
<body>
  <header><h1>üåç Stateout ‚Äî ‡πÅ‡∏ä‡∏£‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h1></header>
  <div id="map"></div>
  <div class="panel">
    <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì...</div>
    <button id="gpsBtn">‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (GPS)</button>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom:19, attribution:'¬© OpenStreetMap contributors'
    }).addTo(map);

    const statusEl = document.getElementById('status');
    const gpsBtn = document.getElementById('gpsBtn');
    let marker;

    function setStatus(t){ statusEl.textContent=t; }

    function showMarker(lat, lon, msg){
      if(marker) map.removeLayer(marker);
      marker = L.marker([lat,lon]).addTo(map);
      marker.bindPopup(msg).openPopup();
      map.setView([lat,lon], 12);
    }

    async function loadByIP(){
      try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();
        showMarker(data.latitude, data.longitude, `üìç ${data.city || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}, ${data.country_name || ''}`);
        setStatus(`‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: ${data.city || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}`);
      } catch(e){
        setStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏≤‡∏Å IP ‡πÑ‡∏î‡πâ');
      }
    }

    function loadGPS(){
      if(!navigator.geolocation){
        alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS');
        return;
      }
      setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ä‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...');
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude, longitude}=pos.coords;
        showMarker(latitude, longitude, 'üìç ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
        setStatus(`‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÅ‡∏•‡πâ‡∏ß (${latitude.toFixed(4)}, ${longitude.toFixed(4)})`);
      },err=>{
        setStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á GPS ‡πÑ‡∏î‡πâ');
      });
    }

    gpsBtn.addEventListener('click', loadGPS);
    loadByIP();
  </script>
</body>
</html>
